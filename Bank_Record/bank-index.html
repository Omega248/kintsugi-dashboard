<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kintsugi Motorworks · Bank Records</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="../shared-styles.css" />
  <link rel="stylesheet" href="bank-style.css" />
  <script src="../constants.js"></script>
  <script src="../utils.js"></script>
  <script src="../ui-enhancements.js"></script>
  <script src="../kintsugi-core.js"></script>
</head>
<body>
  <div class="app">
    <!-- Top nav shared across pages -->
    <div class="top-bar">
      <div>
        <div class="brand-title">Kintsugi Motorworks</div>
      </div>
      <div class="nav-tabs">
        <!-- adjust paths if your structure differs -->
        <a href="../index.html" class="nav-pill">Dashboard</a>
        <a href="../Payouts/payouts-index.html" class="nav-pill">Payouts</a>
        <a href="../Mechanics/mechanics-index.html" class="nav-pill">Mechanics</a>
        <a href="./bank-index.html" class="nav-pill active">Bank</a>
      </div>
    </div>

    <!-- Ledger title -->
    <div class="ledger-header">
      <div class="ledger-title">Transaction Viewer</div>
      <div class="ledger-badge">Ledger</div>
    </div>

    <!-- Controls: filters, file, search, toggles, export -->
    <div class="controls-bar">
      <div class="filter-group">
        <button class="btn active" data-filter="all">All</button>
        <button class="btn" data-filter="in">In</button>
        <button class="btn" data-filter="out">Out</button>
        <button class="btn" data-qfilter="bet">BET Only</button>
        <button class="btn" data-qfilter="grant">Grant Only</button>
        <button class="btn" id="clearQuick">Clear Quick Filters</button>
      </div>

      <label class="file-pill">
        <span>Choose CSV file</span>
        <input type="file" id="fileInput" accept=".csv" />
      </label>

      <input
        id="searchInput"
        class="search-input"
        type="text"
        placeholder="Search comment / name / id / category..."
      />

      <label class="toggle">
        <input type="checkbox" id="toggleBalance" />
        <span>Show Balance</span>
      </label>

      <button class="btn" id="toggleTax">Show Tax</button>

      <button class="btn" id="exportCsvBtn">Export Filtered as CSV</button>

      <div id="status" class="status"></div>
    </div>

    <!-- Config toggle -->
    <div class="controls-bar">
      <div id="configToggle" class="btn config-toggle">
        Config ▾
      </div>
    </div>

    <!-- Config panel -->
    <div class="config-panel" id="configPanel">
      <label>
        BET rate ($/BET)
        <input id="cfgBetRate" type="number" step="1" />
      </label>
      <label>
        Bins per 15 BET
        <input id="cfgBinsPer15" type="number" step="1" />
      </label>
      <label>
        Manual BET left
        <input id="cfgManualBetLeft" type="number" step="1" />
      </label>
      <label>
        Manual red bins left
        <input id="cfgManualRedBins" type="number" step="1" />
      </label>
      <button id="applyConfig" class="btn">Apply</button>
    </div>

    <!-- Summary row -->
    <div class="summary-row">
      <div class="summary-card">
        <div class="label">Total In (visible)</div>
        <div id="totalIn" class="value in">$0</div>
        <div id="countIn" class="hint">0 in transactions</div>
      </div>
      <div class="summary-card">
        <div class="label">Total Out (visible)</div>
        <div id="totalOut" class="value out">$0</div>
        <div id="countOut" class="hint">0 out transactions</div>
      </div>
      <div class="summary-card">
        <div class="label">Net (visible)</div>
        <div id="netTotal" class="value net">$0</div>
        <div class="hint">In − Out (visible rows)</div>
      </div>
      <div class="summary-card">
        <div class="label">Total BET (all BET tx)</div>
        <div id="betTotal" class="value">$0 BET</div>
        <div id="betNote" class="hint"></div>
      </div>
      <div class="summary-card">
        <div class="label">Bins from BET</div>
        <div id="binsTotal" class="value">0 bins</div>
        <div id="binsNote" class="hint"></div>
      </div>
    </div>

    <!-- Table -->
    <div class="table-wrap">
      <table id="table">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Details -->
    <div id="detailsPanel"></div>
  </div>

  <script src="bank-script.js"></script>

  <!-- Phase 1: propagate current querystring into nav links -->
  <script>
    (function () {
      var qs = window.location.search;
      if (!qs) return;

      var navLinks = document.querySelectorAll(".nav-tabs a");
      navLinks.forEach(function (a) {
        var href = a.getAttribute("href");
        if (!href) return;
        try {
          var url = new URL(href, window.location.origin);
          url.search = qs;
          a.setAttribute("href", url.pathname + url.search + url.hash);
        } catch (e) {
          // ignore
        }
      });
    })();
  </script>
</body>
</html>
